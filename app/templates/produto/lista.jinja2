{% extends '_layout.jinja2' %}
{% from 'bootstrap5/utils.html' import render_icon %}
{% from 'bootstrap5/pagination.html' import render_pagination %}

{% block content %}
    <div class="row mb-3">
        <div class="col">
            <div class="card">
                <div class="card-body">
                    <h6 class="card-title">Filtrar por categoria:</h6>
                    <form method="post" action="{{ url_for('produto.lista') }}" id="filterForm">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        <div class="row">
                            {% for categoria in todas_categorias %}
                            <div class="col-md-3 col-sm-4 col-6">
                                <div class="form-check">
                                    <input class="form-check-input categoria-filter" type="checkbox"
                                           name="cat" value="{{ categoria.id }}" id="cat_{{ categoria.id }}"
                                           {% if categoria.id|string in categorias_selecionadas %}checked{% endif %}
                                           onchange="document.getElementById('filterForm').submit();">
                                    <label class="form-check-label" for="cat_{{ categoria.id }}">
                                        {{ categoria.nome }}
                                    </label>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <table class="table table-striped table-hover">
        <thead><tr>
                <th scope="col">Nome do produto</th>
                <th scope="col" class="text-end">Preço</th>
                <th scope="col">Categoria</th>
                <th scope="col">Ativo</th>
                <th scope="col" class="text-end">Estoque</th>
                <th scope="col" class="text-center">Operações</th>
        </tr></thead>
        <tbody>
        {% for produto in rset %}
            <tr><td>{{ produto.nome }}</td>
                <td class="text-end">{{ produto.preco }}</td>
                <td>{% for categoria in produto.categorias %}{{ categoria.nome }}{% if not loop.last %}, {% endif %}{% endfor %}</td>
                <td>{% if produto.ativo %}Ativo{% else %}Inativo{% endif %}</td>
                <td class="text-end">{{ produto.estoque }}</td>
                <td class="text-center">
                    <a href="{{ url_for('produto.delete', produto_id=produto.id) }}"
                       onclick="return confirm('Confirma a remoção do produto?')">{{
                            render_icon('trash', color='danger', size='1.25em')}}</a>
                    <a href="{{ url_for('produto.edit', produto_id = produto.id) }}">{{
                            render_icon('pencil-square', color='primary', size='1.25em') }}</a>
                </td>
        {% endfor %}
        </tbody>
        </table>
    </div>
    <div class="row justify-content-center">
        <div class="clearfix">
            <div class="float-start small">
                Mostrando itens {{ rset.first }} a {{ rset.last }} de um total de
                {{ rset.total }}
                <span class="ms-3">
                    <label for="pageSizeSelector" class="me-2">Itens por página:</label>
                    <select id="pageSizeSelector" class="form-select form-select-sm d-inline-block" style="width: auto;"
                            onchange="window.location.href='{{ url_for('produto.lista') }}?pp=' + this.value + '&page=1';">
                        <option value="1" {% if pp == 1 %}selected{% endif %}>1</option>
                        <option value="5" {% if pp == 5 %}selected{% endif %}>5</option>
                        <option value="10" {% if pp == 10 %}selected{% endif %}>10</option>
                        <option value="20" {% if pp == 20 %}selected{% endif %}>20</option>
                        <option value="25" {% if pp == 25 %}selected{% endif %}>25</option>
                        <option value="50" {% if pp == 50 %}selected{% endif %}>50</option>
                        <option value="100" {% if pp == 100 %}selected{% endif %}>100</option>
                        <option value="all" {% if pp == 'all' %}selected{% endif %}>Todos</option>
                    </select>
                </span>
            </div>
            <div class="float-end">
            {{ render_pagination(rset,
                                 'produto.lista',
                                 align='right',
                                 size='sm',
                                 args={'pp': pp}) }}
            </div>
        </div>
    </div>
{% endblock %}
